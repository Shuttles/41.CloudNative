几个事实

1. **容器**技术的兴起源于 PaaS 技术的普及；
2. Docker 公司发布的 Docker 项目具有里程碑式的意义；
3. Docker 项目通过“**容器镜像**”，解决了**应用打包**这个根本性难题。
4. 容器本身没有价值，有价值的是“**容器编排**”。



# 1.容器

1. 容器其实是一种**沙盒技术**。顾名思义，沙盒就是能够像一个集装箱一样，把你的应用“装”起来的技术。
2. 这样，应用与应用之间，就因为**有了边界而不至于相互干扰**；
3. 而被装进集装箱的应用，也可以被方便地**搬来搬去**，这不就是 PaaS 最理想的状态嘛。



# 2.实现容器的技术

1. 容器技术的核心功能，就是通过==**约束**和**修改**进程的动态表现==，从而为其创造出一个“**边界**”。
2. 对于 Docker 等大多数 Linux 容器来说，**Cgroups 技术**是用来**制造约束**的主要手段，而**Namespace 技术**则是用来**修改进程视图**的主要方法。



## 2.1Namespace

1. Namespace 的使用方式也非常有意思：它其实**只是 Linux 创建新进程的一个可选参数**。

2. 我们知道，在 Linux 系统中创建线程的系统调用是 clone()，比如：

   ```c
   int pid = clone(main_function, stack_size, SIGCHLD, NULL); 
   ```

   这个系统调用就会为我们创建一个新的进程，并且返回它的进程号 pid。

   而当我们用 clone() 系统调用创建一个新进程时，就可以在参数中指定 CLONE_NEWPID 参数，比如：

   ```c
   int pid = clone(main_function, stack_size, CLONE_NEWPID | SIGCHLD, NULL);
   ```

   这时，新创建的这个进程将会“**看到**”一个**全新的进程空间**，在这个进程空间里，它的 PID 是 1。之所以说“看到”，是因为这只是一个“**障眼法**”，在宿主机真实的进程空间里，这个进程的 PID 还是真实的数值，比如 100。

   当然，我们还可以多次执行上面的 clone() 调用，这样就会创建多个 PID Namespace，而每个 Namespace 里的应用进程，**都会认为自己是当前容器里的第 1 号进程**，它们既看不到宿主机里真正的进程空间，也看不到其他 PID Namespace 里的具体情况。



## 2.2其他技术

1. 除了我们刚刚用到的 PID Namespace，Linux 操作系统还提供了 `Mount`、`UTS`、`IPC`、`Network` 和` User `这些 Namespace，用来对**各种不同的进程上下文**进行“障眼法”操作。
2. 比如，Mount Namespace，用于让被隔离进程**只看到当前 Namespace 里的挂载点信息**；Network Namespace，用于让被隔离进程**只看到当前 Namespace 里的网络设备和配置。**



# 3.容器本质

1. 所以，Docker 容器这个听起来玄而又玄的概念，实际上是在创建容器进程时，==指定了这个进程所需要启用的一组 Namespace 参数==。这样，容器就**只能“看”到当前 Namespace 所限定的资源、文件、设备、状态，或者配置**。而对于宿主机以及其他不相关的程序，它就完全看不到了。
2. **所以说，容器，其实是一种==特殊的进程==而已。**

# 虚拟机

1. 谈到为“进程划分一个独立空间”的思想，相信你一定会联想到虚拟机。而且，你应该还看过一张虚拟机和容器的对比图。

   ![](data:image/png;base64,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)

2. 这幅图的左边，画出了**虚拟机的工作原理**。其中，名为 Hypervisor 的软件是虚拟机最主要的部分。它通过硬件虚拟化功能，模拟出了运行一个操作系统需要的各种硬件，比如 CPU、内存、I/O 设备等等。然后，它在这些虚拟的硬件上安装了一个新的操作系统，即 Guest OS。

   这样，用户的应用进程就可以运行在这个虚拟的机器中，它能看到的自然也只有 Guest OS 的文件和目录，以及这个机器里的虚拟设备。**这就是为什么虚拟机也能起到将不同的应用进程相互隔离的作用。**

3. 而这幅图的右边，则用一个名为 Docker Engine 的软件替换了 Hypervisor。这也是为什么，很多人会把 Docker 项目称为“轻量级”虚拟化技术的原因，实际上就是把虚拟机的概念套在了容器上。

   **可是这样的说法，却并不严谨。**

   在理解了 Namespace 的工作方式之后，你就会明白，**跟真实存在的虚拟机不同**，在使用 Docker 的时候，**并没有一个真正的“Docker 容器”运行在宿主机里面**。==Docker 项目帮助用户启动的，还是原来的应用进程，只不过在创建这些进程时，Docker 为它们加上了各种各样的 Namespace 参数。==

   这时，这些进程就会觉得自己是各自 PID Namespace 里的第 1 号进程，只能看到各自 Mount Namespace 里挂载的目录和文件，只能访问到各自 Network Namespace 里的网络设备，就仿佛运行在一个个“容器”里面，与世隔绝。

   不过，相信你此刻已经会心一笑：**这些不过都是“障眼法”罢了**。